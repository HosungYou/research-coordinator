# Diverga v8.2.0 Release Notes

**Release Date**: 2026-02-12
**Type**: Minor Release â€” Checkpoint Enforcement Strengthening
**Previous**: v8.1.0

---

## Highlights

### MCP Runtime Checkpoint Enforcement
Diverga now includes a dedicated MCP (Model Context Protocol) server that provides **runtime verification** of checkpoint prerequisites. This replaces the previous prompt-only enforcement with a programmatic layer that verifies agent prerequisites before execution.

### SKILL.md Simplification
All 28 agent SKILL.md files with checkpoints have been simplified from ~35-line checkpoint sections to ~8-line MCP-based sections, saving **675 lines** of configuration while improving consistency.

### Memory System Optimization
The Python-based memory system (`lib/memory/`, 104 files) has been replaced by a lean MCP server implementation (3 files, ~200 lines of Node.js), eliminating unused design-reference code.

---

## What's New

### MCP Checkpoint Server (7 Tools)

| Tool | Description |
|------|-------------|
| `diverga_check_prerequisites` | Verify agent prerequisites before execution |
| `diverga_mark_checkpoint` | Record checkpoint decision with rationale |
| `diverga_checkpoint_status` | View full checkpoint overview (passed/pending/blocked) |
| `diverga_priority_read` | Read compression-resilient priority context |
| `diverga_priority_write` | Update priority context (auto-updated on checkpoint mark) |
| `diverga_project_status` | Full project status with research context |
| `diverga_decision_add` | Record research decisions to audit trail |

### New Enforcement Rules

- **Rule 5: Override Refusal** â€” REQUIRED checkpoints cannot be skipped, even when user explicitly requests. An AskUserQuestion template is presented instead of text refusal.
- **Rule 6: MCP-First Verification** â€” Agents call `diverga_check_prerequisites(agent_id)` before execution. Falls back to `.research/decision-log.yaml` if MCP is unavailable.

### Priority Context (Compression Resilience)

A 500-character priority context is automatically maintained at `.research/priority-context.md`, summarizing:
- Project name and stage
- Research question
- Checkpoint status
- Last decision

This survives context window compression and can be recovered via `diverga_priority_read`.

---

## What Changed

### State Path Unification
- **Before**: `.claude/state/checkpoints.json`
- **After**: `.research/checkpoints.yaml`
- All state is now unified under `.research/` directory

### SKILL.md Format (28 agents)

**Before** (~35 lines per agent):
```markdown
## â›” Checkpoint Protocol (EXECUTE BEFORE CORE TASK)
### Prerequisites (ë°˜ë“œì‹œ ì™„ë£Œ í›„ ì§„í–‰)
1. CP_RESEARCH_DIRECTION ğŸ”´
2. CP_METHODOLOGY_APPROVAL ğŸ”´
ëŒ€í™” ì´ë ¥ì—ì„œ ìœ„ ì²´í¬í¬ì¸íŠ¸ì˜ ìŠ¹ì¸ì´ í™•ì¸ë˜ì§€ ì•Šìœ¼ë©´...
[20+ more lines]
```

**After** (~8 lines per agent):
```markdown
## â›” Prerequisites (v8.2 â€” MCP Enforcement)
`diverga_check_prerequisites("c5")` â†’ must return `approved: true`
If not approved â†’ AskUserQuestion for each missing checkpoint

### Checkpoints During Execution
- ğŸŸ  CP_ANALYSIS_PLAN â†’ `diverga_mark_checkpoint("CP_ANALYSIS_PLAN", decision, rationale)`

### Fallback (MCP unavailable)
Read `.research/decision-log.yaml` directly. Conversation history is last resort.
```

### Removed: lib/memory/ (104 files)
The Python memory system was a design reference that was never executed at runtime. Its functionality is now provided by the MCP checkpoint server.

---

## What Was Added

| Item | Description |
|------|-------------|
| `mcp/checkpoint-server.js` | MCP server with 7 tools (~200 lines) |
| `mcp/agent-prerequisite-map.json` | 44-agent prerequisite map in JSON |
| `mcp/package.json` | Node.js dependencies |
| `.mcp.json` | MCP server registration |
| 6 checkpoint definitions | CP_SAMPLING_STRATEGY, CP_CODING_APPROACH, CP_THEME_VALIDATION, CP_HUMANIZATION_REVIEW, CP_HUMANIZATION_VERIFY, CP_SEARCH_STRATEGY |
| Override Refusal Template | AskUserQuestion template for REQUIRED checkpoint skip attempts |
| Priority Context section | Added to memory/SKILL.md |

---

## Migration Guide

### For Existing Users

1. **Pull latest**: `git pull origin main`
2. **Install MCP dependencies**: `cd mcp && npm install`
3. **Re-sync skills** (if using local install):
   ```bash
   cd Diverga
   for skill_dir in skills/*/; do
     skill_name=$(basename "$skill_dir")
     cp -r "$skill_dir" ~/.claude/skills/diverga-${skill_name}
   done
   ```
4. **Restart Claude Code**

### Breaking Changes

- `.claude/state/checkpoints.json` â†’ `.research/checkpoints.yaml` (auto-migrated)
- `lib/memory/` removed â€” if you had custom integrations, use MCP tools instead

### No Action Required

- MCP server auto-loads via `plugin.json` â†’ `.mcp.json`
- Existing `.research/` project data is fully compatible
- All checkpoints continue to work via prompt-level enforcement even without MCP

---

## Verification

All 10 verification checks passed:
1. âœ… No remaining `.claude/state/checkpoints` references
2. âœ… 25 SKILL.md files with `diverga_check_prerequisites`
3. âœ… 27 SKILL.md files with `diverga_mark_checkpoint`
4. âœ… Entry point agents correctly configured
5. âœ… Prerequisites-only agents correctly configured
6. âœ… agent-prerequisite-map.json integrity verified
7. âœ… lib/memory/ fully removed
8. âœ… MCP dependencies installed
9. âœ… plugin.json mcpServers field present
10. âœ… No external imports to lib/memory

---

## Full Diagnostic Report

See `docs/DIAGNOSTIC-REPORT-2026-02-12.md` for comprehensive analysis including:
- OMC vs Diverga architecture comparison
- 8 identified gaps and their resolutions
- Competitive positioning analysis
- Complete file change manifest

---

*Diverga v8.2.0 â€” Checkpoint Enforcement Strengthening*
*Released: 2026-02-12*
