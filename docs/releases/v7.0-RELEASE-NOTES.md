# Diverga v7.0 Release Notes

## Memory System Global Deployment Edition

**Release Date**: 2026-02-03
**Version**: 7.0.0

---

## Overview

Diverga v7.0 introduces the **Memory System** - a comprehensive research context persistence layer that enables cross-session continuity, automatic checkpoint enforcement, and research documentation automation. This release transforms Diverga from a session-bound assistant into a **persistent research companion** that remembers your decisions, maintains context, and guides you through the research lifecycle.

---

## Core Philosophy

> **"Human decisions remain with humans. AI handles what's beyond human scope."**
> **"ì¸ê°„ì´ í•  ì¼ì€ ì¸ê°„ì´, AIëŠ” ì¸ê°„ì˜ ë²”ì£¼ë¥¼ ë²—ì–´ë‚œ ê²ƒì„ ìˆ˜í–‰"**

The Memory System ensures that:
1. Critical decisions are **captured and versioned** in an immutable audit trail
2. Context is **automatically available** across sessions and agent calls
3. Researchers never need to **re-explain** their research question, methodology, or prior decisions

---

## What's New

### 1. 3-Layer Context System

Context loading adapted to different interaction patterns:

| Layer | Trigger | Description |
|-------|---------|-------------|
| **Layer 1: Keyword-Triggered** | Natural language | "my research", "ì—°êµ¬ ì§„í–‰" auto-load context |
| **Layer 2: Task Interceptor** | Agent calls | `Task(subagent_type="diverga:*")` auto-injects context |
| **Layer 3: CLI** | Explicit request | `/diverga:memory context` for full details |

#### Layer 1: Keyword Detection

**English Keywords**: "my research", "research status", "research progress", "where was I", "continue research", "what stage", "research question", "my project"

**Korean Keywords**: "ë‚´ ì—°êµ¬", "ì—°êµ¬ ì§„í–‰", "ì—°êµ¬ ìƒíƒœ", "ì–´ë””ê¹Œì§€", "ì§€ê¸ˆ ë‹¨ê³„", "ì—°êµ¬ ê³„ì†", "ì—°êµ¬ ì§ˆë¬¸", "ë‚´ í”„ë¡œì íŠ¸"

When any of these keywords are detected, the system automatically loads and displays research context.

#### Layer 2: Task Interceptor

When calling any `diverga:*` agent via Task tool, context is automatically injected:

```python
# Your call
Task(subagent_type="diverga:a1", prompt="Help refine my research question")

# What the agent receives
"""
# Research Context (Auto-Injected)
Project: AI in Education Meta-Analysis
Research Question: How does AI improve learning outcomes?
Paradigm: Quantitative
Stage: Evidence
Recent Decisions: [CP_RESEARCH_DIRECTION: Meta-analysis selected]

---

# Agent Task
Help refine my research question
"""
```

### 2. Checkpoint Auto-Trigger System

17 standard checkpoints with automatic enforcement:

| Level | Icon | Behavior | Count |
|-------|------|----------|-------|
| **REQUIRED** | ğŸ”´ | Must complete before proceeding | 8 |
| **RECOMMENDED** | ğŸŸ  | Strongly suggested | 5 |
| **OPTIONAL** | ğŸŸ¡ | Can skip with defaults | 4 |

#### Standard Checkpoints

| Checkpoint ID | Stage | Level |
|---------------|-------|-------|
| `CP_RESEARCH_DIRECTION` | Foundation | ğŸ”´ REQUIRED |
| `CP_PARADIGM_SELECTION` | Foundation | ğŸ”´ REQUIRED |
| `CP_THEORY_SELECTION` | Foundation | ğŸŸ  RECOMMENDED |
| `CP_METHODOLOGY_APPROVAL` | Design | ğŸ”´ REQUIRED |
| `CP_DATABASE_SELECTION` | Evidence | ğŸŸ  RECOMMENDED |
| `CP_SCREENING_CRITERIA` | Evidence | ğŸ”´ REQUIRED |
| `CP_QUALITY_APPRAISAL` | Analysis | ğŸŸ  RECOMMENDED |
| `CP_SYNTHESIS_APPROACH` | Analysis | ğŸ”´ REQUIRED |
| `CP_FINAL_REVIEW` | Reporting | ğŸ”´ REQUIRED |

### 3. Decision Audit Trail

All research decisions are:

- **Immutable**: Never modified after creation
- **Versioned**: Amendments create new entries with `amends` reference
- **Contextual**: Capture research question and prior decisions at time of decision

```yaml
# Example decision entry
- id: "dec-003"
  timestamp: "2026-02-03T14:30:00Z"
  checkpoint: "CP_RESEARCH_DIRECTION"
  stage: "foundation"
  agent: "A1-research-question-refiner"
  decision:
    selected: "Meta-analysis"
    alternatives:
      - option: "Systematic Review"
        t_score: 0.75
      - option: "Scoping Review"
        t_score: 0.45
  rationale: "Need quantitative synthesis for effect size aggregation"
  context:
    research_question: "How does AI improve learning outcomes?"
    prior_decisions: ["dec-001", "dec-002"]
  metadata:
    session_id: "abc123-def456"
    user_confirmed: true
```

### 4. Dual-Tree Filesystem Structure

Research state organized into stable baselines and active changes:

```
.research/
â”œâ”€â”€ baselines/              # STABLE TREE (verified foundations)
â”‚   â”œâ”€â”€ literature/         # Literature foundations
â”‚   â”œâ”€â”€ methodology/        # Methodology decisions
â”‚   â””â”€â”€ framework/          # Theoretical frameworks
â”‚
â”œâ”€â”€ changes/                # WORKING TREE
â”‚   â”œâ”€â”€ current/            # Active work
â”‚   â”‚   â”œâ”€â”€ proposal.md
â”‚   â”‚   â””â”€â”€ decisions.yaml
â”‚   â””â”€â”€ archive/            # Completed stages (timestamped)
â”‚       â”œâ”€â”€ 2026-02-01-foundation/
â”‚       â””â”€â”€ 2026-02-02-evidence/
â”‚
â”œâ”€â”€ sessions/               # Session records
â”‚   â””â”€â”€ session-{uuid}.yaml
â”‚
â”œâ”€â”€ project-state.yaml      # Project metadata
â”œâ”€â”€ decision-log.yaml       # All decisions (immutable)
â””â”€â”€ checkpoints.yaml        # Checkpoint states
```

### 5. Research Documentation System

Schema-driven artifact generation with Jinja2-like templates:

#### Schemas

- **Systematic Review**: 5-stage PRISMA 2020 pipeline
- **Meta-Analysis**: 5-stage analysis pipeline

#### Built-in Templates

| Template | Purpose |
|----------|---------|
| `protocol.md.j2` | Research protocol |
| `search-strategy.md.j2` | Database search strategy |
| `inclusion-criteria.md.j2` | PICO criteria |
| `quality-assessment.md.j2` | Risk of bias assessment |
| `prisma-diagram.md.j2` | PRISMA 2020 flow diagram |
| `manuscript.md.j2` | Manuscript draft |

### 6. Migration Support

Automatic migration from v6.8 to v7.0:

```bash
# Preview changes
/diverga:memory migrate --dry-run

# Execute migration
/diverga:memory migrate
```

#### Migration Features

- **Backup**: Creates `.research-backup-v68-{timestamp}/` before migration
- **Rollback**: Full rollback support if migration fails
- **Non-destructive**: Original data preserved in backup

---

## New Files

### Core Library (`lib/memory/src/`)

| File | Purpose | Lines |
|------|---------|-------|
| `models.py` | Data models (ResearchContext, Checkpoint, Decision) | ~250 |
| `context_trigger.py` | Layer 1: Keyword-triggered context | ~460 |
| `task_interceptor.py` | Layer 2: Agent context injection | ~290 |
| `checkpoint_trigger.py` | Checkpoint auto-trigger | ~300 |
| `fs_state.py` | Filesystem state management | ~200 |
| `dual_tree.py` | Dual-tree structure | ~250 |
| `archive.py` | Stage archiving | ~200 |
| `decision_log.py` | Decision audit trail | ~280 |
| `session_hooks.py` | Session lifecycle | ~250 |
| `schema.py` | Research schema definitions | ~300 |
| `templates.py` | Template engine | ~280 |
| `artifact_generator.py` | Artifact generation | ~300 |
| `cli.py` | CLI commands | ~760 |
| `migration.py` | v6.8 â†’ v7.0 migration | ~350 |
| `memory_api.py` | Unified facade API | ~400 |

**Total**: 15 modules, ~4,400 lines of Python code

### Templates (`templates/`)

| Directory | Files |
|-----------|-------|
| `systematic-review/` | 8 files (schema + 7 templates) |
| `meta-analysis/` | 4 files (schema + 3 templates) |
| `checkpoints/` | 1 file (17 checkpoint definitions) |

### Documentation

| File | Purpose |
|------|---------|
| `lib/memory/README.md` | Comprehensive library documentation |
| `skills/memory/SKILL.md` | Skill definition for Claude Code |
| `templates/README.md` | Template usage guide |

---

## API Reference

### MemoryAPI Class

23 methods for complete memory system access:

```python
from lib.memory import MemoryAPI
from pathlib import Path

memory = MemoryAPI(project_root=Path("."))

# Context Layer 1
memory.should_load_context("What's my research status?")  # True
memory.display_context()  # Formatted markdown

# Context Layer 2
memory.intercept_task("diverga:a1", prompt)  # Enriched prompt

# Session Management
session_id = memory.start_session()
memory.end_session()

# Checkpoint Management
checkpoint = memory.check_checkpoint("a1", "task_start")
memory.record_checkpoint("CP_RESEARCH_DIRECTION", "approved")
pending = memory.get_pending_checkpoints()

# Decision Management
dec_id = memory.add_decision(
    checkpoint="CP_RESEARCH_DIRECTION",
    selected="Meta-analysis",
    rationale="Need quantitative synthesis"
)
memory.amend_decision("dec-001", "Scoping review", "Changed scope")
decisions = memory.get_recent_decisions(limit=5)

# Project Management
memory.initialize_project("AI Study", "Research question", "quantitative")
state = memory.get_project_state()
stage = memory.get_current_stage()

# Documentation
artifact_path = memory.generate_artifact("protocol")
archive_path = memory.archive_stage("foundation", "Complete")

# Migration
if memory.needs_migration():
    memory.migrate(dry_run=False)
```

---

## CLI Commands

| Command | Description |
|---------|-------------|
| `/diverga:memory status` | Show project status |
| `/diverga:memory context [--verbose]` | Display full context |
| `/diverga:memory init --name N --question Q --paradigm P` | Initialize project |
| `/diverga:memory decision list [--stage S]` | List decisions |
| `/diverga:memory decision add --checkpoint C --selected S --rationale R` | Add decision |
| `/diverga:memory decision amend --id ID --selected S --rationale R` | Amend decision |
| `/diverga:memory archive [STAGE] [--summary S]` | Archive completed stage |
| `/diverga:memory generate ARTIFACT_ID` | Generate artifact |
| `/diverga:memory migrate [--dry-run]` | Run migration |

---

## Breaking Changes

### Directory Structure

| v6.x | v7.0 |
|------|------|
| `.diverga/memory/` | `.research/` |
| No baselines | `.research/baselines/` |
| No changes tracking | `.research/changes/` |

### Decision Log Schema

New fields added:
- `context.research_question`
- `context.prior_decisions`
- `metadata.session_id`
- `metadata.user_confirmed`

### Checkpoint Format

Updated YAML schema with:
- `triggers` array (file_exists, decision_made, stage_entry)
- `validation` rules
- `persistence` configuration

---

## Migration Guide

### Automatic Migration

1. Run `/diverga:memory migrate --dry-run` to preview changes
2. Run `/diverga:memory migrate` to execute
3. Backup created at `.research-backup-v68-{timestamp}/`
4. Rollback available if needed

### Manual Migration

If automatic migration fails:

1. Backup `.diverga/` directory
2. Create `.research/` structure manually
3. Copy `project-state.yaml` with new fields
4. Update `decision-log.yaml` to new schema

---

## Technical Details

### Python Compatibility

- **Minimum**: Python 3.8+
- **Dependencies**: Standard library only (no external packages required)
- **Optional**: PyYAML for enhanced YAML handling

### Korean Text Support

- UTF-8 encoding throughout all modules
- `ensure_ascii=False` in JSON serialization
- `allow_unicode=True` in YAML serialization
- Bilingual keyword detection (15 EN + 15 KR)

### Performance

- Lazy context loading (only when triggered)
- Session state cached in memory
- File-based persistence (no database required)

---

## Verification

```
âœ… All 15 modules import successfully
âœ… MemoryAPI instantiated - version 7.0.0
âœ… 23 API methods available
âœ… Templates render correctly
âœ… Checkpoint triggers function
âœ… Korean keyword detection works
âœ… Migration script tested
```

---

## Known Issues

1. **First-time setup**: Run `/diverga:memory init` before using other commands
2. **Large projects**: Archive completed stages to keep `.research/changes/current/` small
3. **Session persistence**: End session explicitly for best data capture

---

## Upgrade Path

| Current Version | Upgrade Command |
|-----------------|-----------------|
| v6.8.x | `/diverga:memory migrate` |
| v6.5.x - v6.7.x | Manual migration required |
| v6.0.x - v6.4.x | Fresh install recommended |

---

## Contributors

- Hosung You - Architecture & Implementation
- Claude Opus 4.5 - Code Generation & Documentation

---

## License

MIT License - See LICENSE file for details.

---

## Related Documentation

- [Library README](../../lib/memory/README.md)
- [SKILL.md](../../skills/memory/SKILL.md)
- [Templates Guide](../../templates/README.md)
- [CHANGELOG](../../CHANGELOG.md)
