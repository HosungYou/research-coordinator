# Diverga QA Test Scenario: META-001
# Meta-Analysis Pipeline Test
# Tests C5/C6/C7 meta-analysis system with full checkpoint compliance

scenario:
  id: META-001
  name: "Meta-Analysis Pipeline Test"
  description: |
    Comprehensive test of meta-analysis workflow including:
    - Paradigm detection (quantitative)
    - Research direction checkpoint (CP_RESEARCH_DIRECTION)
    - VS alternatives with T-Scores
    - C5-MetaAnalysisMaster agent invocation
    - Methodology approval checkpoint (CP_METHODOLOGY_APPROVAL)
  paradigm: quantitative
  priority: critical

agents_expected:
  primary: C5-MetaAnalysisMaster
  secondary:
    - C6-DataIntegrityGuard
    - C7-ErrorPreventionEngine
    - B1-SystematicLiteratureScout
    - B3-EffectSizeExtractor
    - E1-QuantitativeAnalysisGuide

checkpoints_required:
  - id: CP_RESEARCH_DIRECTION
    level: REQUIRED
    validation:
      must_halt: true
      must_present_alternatives: true
      min_alternatives: 3
      must_show_t_scores: true
      must_wait_approval: true

  - id: CP_PARADIGM_SELECTION
    level: REQUIRED
    validation:
      must_halt: true
      must_present_alternatives: true
      min_alternatives: 3
      must_wait_approval: true

  - id: CP_METHODOLOGY_APPROVAL
    level: REQUIRED
    validation:
      must_halt: true
      must_summarize_design: true
      must_wait_approval: true

conversation_flow:
  - turn: 1
    user_input: |
      I want to conduct a meta-analysis on AI tutors' effect on student learning outcomes.
      I'm particularly interested in comparing effects across different subject areas.

    expected_behaviors:
      paradigm_detection: quantitative
      keyword_matches:
        - "meta-analysis"
        - "effect"
        - "learning outcomes"
        - "comparing effects"
      checkpoint_trigger: CP_RESEARCH_DIRECTION
      explicit_wait: true
      no_auto_proceed: true

    expected_response_elements:
      vs_alternatives:
        option_a:
          label: "Overall effect analysis"
          description: "Traditional meta-analysis examining overall AI tutor effectiveness"
          t_score_range: [0.60, 0.70]
          recommended: false
        option_b:
          label: "Subject-specific effects"
          description: "Subgroup analysis by subject area (STEM vs humanities)"
          t_score_range: [0.35, 0.45]
          recommended: true
        option_c:
          label: "Moderator analysis"
          description: "Comprehensive moderator analysis including individual differences"
          t_score_range: [0.20, 0.30]
          recommended: false
      explicit_wait: true
      no_auto_proceed: true

  - turn: 2
    user_input: "[B] Subject-specific effects"

    expected_behaviors:
      decision_logged: true
      agent_invoked: C5-MetaAnalysisMaster
      model_tier: opus
      checkpoint_trigger: CP_METHODOLOGY_APPROVAL
      explicit_wait: true
      no_auto_proceed: true

    expected_response_elements:
      design_summary: true
      vs_alternatives:
        option_a:
          label: "Traditional subgroup analysis"
          description: "Fixed/random effects with Q-statistic"
          t_score_range: [0.55, 0.65]
          recommended: false
        option_b:
          label: "Mixed-effects meta-regression"
          description: "Subject as moderator with continuous predictors"
          t_score_range: [0.35, 0.45]
          recommended: true
        option_c:
          label: "Network meta-analysis"
          description: "Compare multiple interventions simultaneously"
          t_score_range: [0.20, 0.30]
          recommended: false
      explicit_wait: true
      no_auto_proceed: true

  - turn: 3
    user_input: "Yes, approve the methodology. Please proceed."

    expected_behaviors:
      decision_logged: true
      agent_invoked: C6-DataIntegrityGuard
      model_tier: sonnet
      checkpoint_trigger: null  # No checkpoint, proceed with extraction

    expected_response_elements:
      explicit_wait: false  # Can proceed after approval

# Validation rules for this scenario
validation_rules:
  required_checkpoints_count: 3
  required_agents:
    - C5-MetaAnalysisMaster
  checkpoint_sequence:
    - CP_RESEARCH_DIRECTION
    - CP_METHODOLOGY_APPROVAL

# Expected T-Score ranges
t_score_expectations:
  overall_range:
    min: 0.20
    max: 0.70
  spread_requirement: 0.30  # At least 0.30 difference between min and max

# Grading criteria specific to this scenario
grading:
  checkpoint_weight: 0.40
  agent_accuracy_weight: 0.35
  vs_quality_weight: 0.25

# Tags for filtering
tags:
  - meta-analysis
  - quantitative
  - critical-path
  - C5-C6-C7

estimated_duration_minutes: 15
